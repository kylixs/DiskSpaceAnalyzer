# DiskSpaceAnalyzer Makefile
# ç®€åŒ–æ„å»ºå‘½ä»¤çš„å¿«æ·æ–¹å¼

.PHONY: help clean debug release test package dev watch ci all

# é»˜è®¤ç›®æ ‡
help:
	@echo "DiskSpaceAnalyzer æ„å»ºç³»ç»Ÿ"
	@echo ""
	@echo "å¯ç”¨å‘½ä»¤:"
	@echo "  make help      - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"
	@echo "  make clean     - æ¸…ç†æ„å»ºç›®å½•"
	@echo "  make debug     - æ„å»ºDebugç‰ˆæœ¬"
	@echo "  make release   - æ„å»ºReleaseç‰ˆæœ¬"
	@echo "  make test      - è¿è¡Œæµ‹è¯•"
	@echo "  make package   - æ‰“åŒ…åº”ç”¨ç¨‹åº"
	@echo "  make dev       - å¼€å‘æ¨¡å¼ï¼ˆæ„å»ºå¹¶è¿è¡Œï¼‰"
	@echo "  make watch     - ç›‘è§†æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨é‡æ–°æ„å»º"
	@echo "  make ci        - è¿è¡ŒCIæµç¨‹"
	@echo "  make all       - å®Œæ•´æ„å»ºæµç¨‹"
	@echo ""
	@echo "ç¤ºä¾‹:"
	@echo "  make debug     # å¿«é€Ÿæ„å»ºDebugç‰ˆæœ¬"
	@echo "  make all       # å®Œæ•´æ„å»ºå’Œæ‰“åŒ…"

# æ¸…ç†æ„å»ºç›®å½•
clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºç›®å½•..."
	@./scripts/build.sh --clean

# æ„å»ºDebugç‰ˆæœ¬
debug:
	@echo "ğŸ”¨ æ„å»ºDebugç‰ˆæœ¬..."
	@./scripts/build.sh --debug

# æ„å»ºReleaseç‰ˆæœ¬
release:
	@echo "ğŸš€ æ„å»ºReleaseç‰ˆæœ¬..."
	@./scripts/build.sh --release

# è¿è¡Œæµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	@./scripts/build.sh --test

# æ‰“åŒ…åº”ç”¨ç¨‹åº
package: release
	@echo "ğŸ“¦ æ‰“åŒ…åº”ç”¨ç¨‹åº..."
	@./scripts/build.sh --package
	@./scripts/package.sh --all

# å¼€å‘æ¨¡å¼
dev:
	@echo "ğŸ‘¨â€ğŸ’» å¼€å‘æ¨¡å¼..."
	@./scripts/dev-build.sh --run

# ç›‘è§†æ¨¡å¼
watch:
	@echo "ğŸ‘€ ç›‘è§†æ–‡ä»¶å˜åŒ–..."
	@./scripts/dev-build.sh --watch

# CIæµç¨‹
ci:
	@echo "ğŸ¤– è¿è¡ŒCIæµç¨‹..."
	@./scripts/ci-build.sh --full

# å®Œæ•´æ„å»ºæµç¨‹
all:
	@echo "ğŸ¯ å®Œæ•´æ„å»ºæµç¨‹..."
	@./scripts/build.sh --all
	@./scripts/package.sh --all

# å¿«é€Ÿè¿è¡Œï¼ˆä¸é‡æ–°æ„å»ºï¼‰
run:
	@echo "â–¶ï¸ è¿è¡Œåº”ç”¨ç¨‹åº..."
	@if [ -f .build/debug/DiskSpaceAnalyzer ]; then \
		./.build/debug/DiskSpaceAnalyzer; \
	else \
		echo "âŒ Debugç‰ˆæœ¬ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ make debug"; \
	fi

# å®‰è£…åˆ°ç³»ç»Ÿï¼ˆå¯é€‰ï¼‰
install: release
	@echo "ğŸ“¥ å®‰è£…åˆ°ç³»ç»Ÿ..."
	@if [ -f .build/release/DiskSpaceAnalyzer ]; then \
		sudo cp .build/release/DiskSpaceAnalyzer /usr/local/bin/; \
		echo "âœ… å·²å®‰è£…åˆ° /usr/local/bin/DiskSpaceAnalyzer"; \
	else \
		echo "âŒ Releaseç‰ˆæœ¬ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ make release"; \
	fi

# å¸è½½ï¼ˆå¯é€‰ï¼‰
uninstall:
	@echo "ğŸ—‘ï¸ ä»ç³»ç»Ÿå¸è½½..."
	@if [ -f /usr/local/bin/DiskSpaceAnalyzer ]; then \
		sudo rm /usr/local/bin/DiskSpaceAnalyzer; \
		echo "âœ… å·²ä»ç³»ç»Ÿå¸è½½"; \
	else \
		echo "â„¹ï¸ ç³»ç»Ÿä¸­æœªæ‰¾åˆ°å®‰è£…çš„ç‰ˆæœ¬"; \
	fi

# æ˜¾ç¤ºæ„å»ºä¿¡æ¯
info:
	@echo "ğŸ“Š é¡¹ç›®ä¿¡æ¯:"
	@echo "  é¡¹ç›®åç§°: DiskSpaceAnalyzer"
	@echo "  ç‰ˆæœ¬: 1.0.0"
	@echo "  å¹³å°: macOS 13.0+"
	@echo "  è¯­è¨€: Swift 5.9+"
	@echo "  æ¶æ„: æ¨¡å—åŒ–è®¾è®¡ï¼ˆ10ä¸ªæ¨¡å—ï¼‰"
	@echo ""
	@echo "ğŸ“ ç›®å½•ç»“æ„:"
	@find sources -type d -maxdepth 1 | sort
	@echo ""
	@echo "ğŸ§ª æµ‹è¯•æ¨¡å—:"
	@find tests -type d -maxdepth 1 | sort
